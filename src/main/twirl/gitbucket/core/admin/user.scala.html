@(account: Option[gitbucket.core.model.Account], extraMailAddresses: List[String], error: Option[Any] = None)(implicit context: gitbucket.core.controller.Context)
@gitbucket.core.html.main(if(account.isEmpty) "New user" else "Update user"){
  @gitbucket.core.admin.html.menu("users"){
<div class="content-header">
  <div class="container-fluid">
    <div class="row mb-2">
      <div class="col-sm-6">
        <h1 class="m-0 text-dark"></h1>
      </div><!-- /.col -->
    </div><!-- /.row -->
  </div><!-- /.container-fluid -->
</div><!-- /.content-header -->
<div class="content body">
  <div class="container">
    @gitbucket.core.helper.html.error(error)
    <div class="row">
      <div class="col">
        <div class="card">
          <div class="card-header">
            <h4>User settings</h4>
          </div><!-- /.card-header -->
          <form method="POST" validate="true" autocomplete="off">
            <div class="card-body">
              <div class="row">
                <div class="col-md-6">
                  <fieldset class="form-group">
                    <label for="userName">Username:</label>
                    <div>
                      <span id="error-userName" class="error text-danger"></span>
                    </div>
                    <input type="text" name="userName" id="userName" class="form-control" value="@account.map(_.userName)"@if(account.isDefined){ readonly}/>
                    @if(account.isDefined){
                    <div class="form-check">
                      <input type="checkbox" class="form-check-input" name="removed" id="removed" value="true" @if(account.get.isRemoved){checked}/>
                      <label class="form-check-label" for="removed">Disable</label>
                    </div>
                    <div>
                      <span id="error-removed" class="error text-danger"></span>
                    </div>
                    }
                  </fieldset>
                  @if(account.map(_.password.nonEmpty).getOrElse(true)){
                  <fieldset class="form-group">
                    <label for="password">
                      Password
                      @if(account.isDefined){
                      (Input to change password)
                      }
                      :
                    </label>
                    <div>
                      <span id="error-password" class="error text-danger"></span>
                    </div>
                    <input type="password" name="password" id="password" class="form-control" value="" autocomplete="off"/>
                  </fieldset>
                  }
                  <fieldset class="form-group">
                    <label for="fullName">Full Name:</label>
                    <div>
                      <span id="error-fullName" class="error text-danger"></span>
                    </div>
                    <input type="text" name="fullName" id="fullName" class="form-control" value="@account.map(_.fullName)"/>
                  </fieldset>
                  <fieldset class="form-group">
                    <label for="mailAddress">Mail Address:</label>
                    <div>
                      <span id="error-mailAddress" class="error text-danger"></span>
                    </div>
                    <input type="text" name="mailAddress" id="mailAddress" class="form-control" value="@account.map(_.mailAddress)"/>
                  </fieldset>
                  <fieldset class="form-group" id="extraMailAddresses">
                    <label>Additional Mail Address:</label>
                    @extraMailAddresses.zipWithIndex.map { case (mail, idx) =>
                    <input type="text" name="extraMailAddresses[@idx]" id="extraMailAddresses[@idx]" class="form-control extraMailAddress" value="@mail" aria-label="Additional mail address"/>
                    <span id="error-extraMailAddresses_@idx" class="error text-danger"></span>
                    }
                  </fieldset>
                  <fieldset class="form-group">
                    <label>User Type:</label>
                    <div class="form-check">
                      <input type="radio" class="form-check-input" name="isAdmin" id="userType_Normal" value="false"@if(account.isEmpty || !account.get.isAdmin){ checked}/>
                      <label class="form-check-label" for="userType_Normal">Normal</label>
                    </div>
                    <div class="form-check">
                      <input type="radio" class="form-check-input" name="isAdmin" id="userType_Admin" value="true"@if(account.isDefined && account.get.isAdmin){ checked}/>
                      <label class="form-check-label" for="userType_Admin">Administrator</label>
                    </div>
                  </fieldset>
                  <fieldset class="form-group">
                    <label for="url">URL (Optional):</label>
                    <div>
                      <span id="error-url" class="error text-danger"></span>
                    </div>
                    <input type="text" name="url" id="url" class="form-control" value="@account.map(_.url)"/>
                  </fieldset>
                  <fieldset class="form-group">
                    <label for="description">Bio (Optional):</label>
                    <div>
                      <span id="error-description" class="error text-danger"></span>
                    </div>
                    <textarea name="description" id="description" class="form-control">@account.map(_.description)</textarea>
                  </fieldset>
                </div>
                <div class="col-md-6">
                  <fieldset class="form-group">
                    <label for="avatar">Image (Optional)</label>
                    @gitbucket.core.helper.html.uploadavatar(account)
                  </fieldset>
                </div>
              </div>
            </div><!-- /.card-body"-->
            <div class="card-footer">
              <div class="float-right">
                <fieldset>
                  @if(account.isEmpty){
                  <input type="submit" class="btn btn-success" value="Create user" formaction="@context.path/admin/users/_newuser"/>
                  } else {
                  <input type="submit" class="btn btn-success" value="Update user" formaction="@context.path/admin/users/@account.get.userName/_edituser" id="update"/>
                  }
                  <a href="@context.path/admin/users" class="btn btn-default">Cancel</a>
                </fieldset>
              </div>
            </div><!-- /.card-footer -->
          </form>
        </div><!-- /.card -->
      </div><!-- /.col -->
    </div><!-- /.row -->
  </div><!-- /container -->
</div><!-- /.content-body -->



  }
}
<script>
$(function(){
  addExtraMailAddress();
  $('#extraMailAddresses').on('change', '.extraMailAddress', checkExtraMailAddress);
  $('#update').click(function(){
    if($('#password').val() != ''){
      return confirm('Are you sure you want to change password of this user?');
    } else {
      return true;
    }
  });
});
</script>
