@(branch: String,
  repository: gitbucket.core.service.RepositoryService.RepositoryInfo,
  pathList: List[String],
  fileName: Option[String],
  content: gitbucket.core.util.JGitUtil.ContentInfo,
  protectedBranch: Boolean,
  commit: String,
  newLineMode: String = "auto",
  useSoftTabs: Boolean = false,
  tabSize: Int = 8
)(implicit context: gitbucket.core.controller.Context)
@import gitbucket.core.view.helpers
@gitbucket.core.html.main(if(fileName.isEmpty) "New File" else s"Editing ${fileName.get} at ${branch} - ${repository.owner}/${repository.name}", Some(repository)) {
  @gitbucket.core.html.menu("files", repository){
    @if(protectedBranch){
      <div class="alert alert-danger">branch @branch is protected.</div>
    }
    <form method="POST" action="@helpers.url(repository)/@if(fileName.isEmpty){create}else{update}" validate="true" autocomplete="off">
      <span class="error" id="error-newFileName"></span>
      <span class="error" id="error-commit"></span>
      <div class="head">
        <a href="@helpers.url(repository)/tree/@helpers.encodeRefName(branch)">@repository.name</a> /
        @pathList.zipWithIndex.map { case (section, i) =>
          <a href='@helpers.url(repository)/tree/@helpers.encodeRefName((branch :: pathList.take(i + 1)).mkString("/"))'>@section</a> /
        }
        <input type="text" name="newFileName" id="newFileName" class="form-control" placeholder="Name your file..." value="@fileName" style="display: inline; width: 300px;" aria-label="New file name"/>
        <input type="hidden" name="oldFileName" id="oldFileName" value="@fileName"/>
        <input type="hidden" name="branch" id="branch" value="@branch"/>
        <input type="hidden" name="path" id="path" value='@pathList.mkString("/")'/>
      </div>
      @gitbucket.core.helper.html.acenavbar()
      <table class="table table-bordered">
        <tr>
          <td>
            <div id="editor" style="width: 100%; height: 600px;"></div>
            <div id="preview" style="width: 100%; display: none;"></div>
          </td>
        </tr>
      </table>
      <div class="panel panel-default issue-comment-box">
        <div class="panel-body">
          <label for="message" class="strong">Commit changes</label>
          <div class="form-group">
            <input type="text" id="message" name="message" class="form-control"/>
          </div>
          <div class="form-group">
            <div class="col-md-12">
              <label class="radio">
                <input type="radio" id="newBranch" name="newBranch" value="false" checked>
                <i class='octicon octicon-git-commit'></i><span>Commit directly to the <strong style="background-color: lightblue; font-family: Consolas">@branch</strong> branch.</span>
              </label>
              <label class="radio">
                <input type="radio" id="newBranch"  name="newBranch" value="true">
                <i class='octicon octicon-git-pull-request'></i><span>Create a <strong>new branch</strong> for this commit and start a pull request.</span>
              </label>
            </div>
          </div>
          <div style="text-align: right;">
            @if(fileName.isEmpty){
              <a href='@helpers.url(repository)/tree/@helpers.encodeRefName((branch :: pathList).mkString("/"))' class="btn btn-default">Cancel</a>
            } else {
              <a href='@helpers.url(repository)/blob/@helpers.encodeRefName((branch :: pathList ++ Seq(fileName.get)).mkString("/"))' class="btn btn-default">Cancel</a>
            }
            <input type="submit" id="commitButton" class="btn btn-success" value="Commit changes" disabled="true"/>
            <input type="hidden" id="charset" name="charset" value="@content.charset"/>
            <input type="hidden" id="lineSeparator" name="lineSeparator" value="@content.lineSeparator"/>
            <input type="hidden" id="content" name="content" value=""/>
            <input type="hidden" id="initial" value="@content.content"/>
            <input type="hidden" id="commit" name="commit" value="@commit"/>
          </div>
        </div>
      </div>
    </form>
    <script src='@helpers.assets("/vendors/ace/ace.js")' type="text/javascript" charset="utf-8"></script>
    <script src='@helpers.assets("/vendors/ace/ext-modelist.js")' type="text/javascript" charset="utf-8"></script>
    <script type="text/javascript" src='@helpers.assets("/vendors/jsdifflib/difflib.js")'></script>
    <link href='@helpers.assets("/vendors/jsdifflib/diffview.css")' type="text/css" rel="stylesheet" />
    <script>
      const gitbucket = {
        editor: null,
        enableWikiLink: false,
        protected: @protectedBranch,
        previewTemplate: '<img src="@helpers.assets("/common/images/indicator.gif")"> Previewing...',
        previewUrl: '@helpers.url(repository)/_preview',
        uploadUrl: '@context.path/upload/wiki/@repository.owner/@repository.name',
        maxFilesize: @{ context.settings.upload.maxFileSize / 1024 / 1024 },
        timeout: @{ context.settings.upload.timeout },
        isRenderableUrl: "@context.baseUrl/_is_renderable?filename=",
        tabSize: @tabSize,
        newLineMode: "@newLineMode",
        useSoftTabs: @useSoftTabs,
        getFileName: function () {
          return $('#newFileName').val();
        },
        getFilePath:  function () {
          return $('#path').val() + '/' + $('#newFileName').val();
        },
      };
    </script>
    <script src="@helpers.assets("/common/js/editor.js")" type="text/javascript" charset="utf-8"></script>
  }
}
