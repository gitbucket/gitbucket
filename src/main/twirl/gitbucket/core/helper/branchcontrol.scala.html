@(branch: String  = "",
  repository: gitbucket.core.service.RepositoryService.RepositoryInfo,
  hasWritePermission: Boolean)(body: Html)(implicit context: gitbucket.core.controller.Context)
@import gitbucket.core.view.helpers
@gitbucket.core.helper.html.dropdown(
  value  = if(branch.length == 40) branch.substring(0, 10) else branch,
  prefix = if(branch.length == 40) "tree" else if(repository.branchList.contains(branch)) "branch" else "tree",
  maxValueWidth = "200px"
) {
  <div class="px-2 py-1">
    <div id="branch-control-title">
      <span>Switch branches</span>
      <button id="branch-control-close"  class="close" data-dismiss="modal" aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <input id="branch-control-input" type="text" class="form-control form-control-sm" placeholder="Find or create branch ..."/>
  </div>
  @body
  @if(hasWritePermission) {
    <a class="dropdown-item"><form action="@helpers.url(repository)/branches" method="post">
      <span class="strong">Create branch:&nbsp;<span class="new-branch"></span></span>
      <br><span style="padding-left: 17px;">from&nbsp;'@branch'</span>
      <input type="hidden" name="new">
      <input type="hidden" name="from" value="@branch">
    </form></a>
  }
}
<script>
  $(function(){
    $('#branch-control-input').parent().click(function(e) {
      e.stopPropagation();
    });
    $('#branch-control-close').click(function() {
      $('[data-toggle="dropdown"]').parent().removeClass('open');
    });
    $('#branch-control-input').keyup(function() {
      var inputVal = $('#branch-control-input').val();
      $.each($('#branch-control-input').parent().parent().find('a'), function(index, elem) {
        if (!inputVal || !elem.text.trim() || elem.text.trim().toLowerCase().indexOf(inputVal.toLowerCase()) >= 0) {
          $(elem).parent().show();
        } else {
          $(elem).parent().hide();
        }
      });
      @if(hasWritePermission) {
        if (inputVal) {
          $('#create-branch').parent().find('li:last-child').show().find('.new-branch').text(inputVal);
        } else {
          $('#create-branch').parent().find('li:last-child').hide();
        }
      }
    });
    @if(hasWritePermission) {
      $('#create-branch').click(function() {
        $(this).find('input[name="new"]').val($('.dropdown-menu input').val())
        $(this).find('form').submit()
       });
    }
    $('.btn-group').click(function() {
      $('#branch-control-input').val('');
      $('.dropdown-menu li').show();
      $('#create-branch').hide();
    });
  });
</script>
